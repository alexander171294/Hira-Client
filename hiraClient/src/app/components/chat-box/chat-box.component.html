<main [class.embedded]="embd">
  <header *ngIf="!embd">
    <svg *ngIf="chatType === 'CHANNEL'" aria-hidden="true" focusable="false" data-prefix="fas" data-icon="hashtag" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512" class="svg-inline--fa fa-hashtag fa-w-14"><path fill="currentColor" d="M440.667 182.109l7.143-40c1.313-7.355-4.342-14.109-11.813-14.109h-74.81l14.623-81.891C377.123 38.754 371.468 32 363.997 32h-40.632a12 12 0 0 0-11.813 9.891L296.175 128H197.54l14.623-81.891C213.477 38.754 207.822 32 200.35 32h-40.632a12 12 0 0 0-11.813 9.891L132.528 128H53.432a12 12 0 0 0-11.813 9.891l-7.143 40C33.163 185.246 38.818 192 46.289 192h74.81L98.242 320H19.146a12 12 0 0 0-11.813 9.891l-7.143 40C-1.123 377.246 4.532 384 12.003 384h74.81L72.19 465.891C70.877 473.246 76.532 480 84.003 480h40.632a12 12 0 0 0 11.813-9.891L151.826 384h98.634l-14.623 81.891C234.523 473.246 240.178 480 247.65 480h40.632a12 12 0 0 0 11.813-9.891L315.472 384h79.096a12 12 0 0 0 11.813-9.891l7.143-40c1.313-7.355-4.342-14.109-11.813-14.109h-74.81l22.857-128h79.096a12 12 0 0 0 11.813-9.891zM261.889 320h-98.634l22.857-128h98.634l-22.857 128z" class=""></path></svg>
    <svg *ngIf="chatType === 'PRIVMSG'"  aria-hidden="true" focusable="false" data-prefix="far" data-icon="comment" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" class="svg-inline--fa fa-comment fa-w-16"><path fill="currentColor" d="M256 32C114.6 32 0 125.1 0 240c0 47.6 19.9 91.2 52.9 126.3C38 405.7 7 439.1 6.5 439.5c-6.6 7-8.4 17.2-4.6 26S14.4 480 24 480c61.5 0 110-25.7 139.1-46.3C192 442.8 223.2 448 256 448c141.4 0 256-93.1 256-208S397.4 32 256 32zm0 368c-26.7 0-53.1-4.1-78.4-12.1l-22.7-7.2-19.5 13.8c-14.3 10.1-33.9 21.4-57.5 29 7.3-12.1 14.4-25.7 19.9-40.2l10.6-28.1-20.6-21.8C69.7 314.1 48 282.2 48 240c0-88.2 93.3-160 208-160s208 71.8 208 160-93.3 160-208 160z" class=""></path></svg>
    <svg *ngIf="chatType === 'SERVER'" aria-hidden="true" focusable="false" data-prefix="fas" data-icon="server" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" class="svg-inline--fa fa-server fa-w-16"><path fill="currentColor" d="M480 160H32c-17.673 0-32-14.327-32-32V64c0-17.673 14.327-32 32-32h448c17.673 0 32 14.327 32 32v64c0 17.673-14.327 32-32 32zm-48-88c-13.255 0-24 10.745-24 24s10.745 24 24 24 24-10.745 24-24-10.745-24-24-24zm-64 0c-13.255 0-24 10.745-24 24s10.745 24 24 24 24-10.745 24-24-10.745-24-24-24zm112 248H32c-17.673 0-32-14.327-32-32v-64c0-17.673 14.327-32 32-32h448c17.673 0 32 14.327 32 32v64c0 17.673-14.327 32-32 32zm-48-88c-13.255 0-24 10.745-24 24s10.745 24 24 24 24-10.745 24-24-10.745-24-24-24zm-64 0c-13.255 0-24 10.745-24 24s10.745 24 24 24 24-10.745 24-24-10.745-24-24-24zm112 248H32c-17.673 0-32-14.327-32-32v-64c0-17.673 14.327-32 32-32h448c17.673 0 32 14.327 32 32v64c0 17.673-14.327 32-32 32zm-48-88c-13.255 0-24 10.745-24 24s10.745 24 24 24 24-10.745 24-24-10.745-24-24-24zm-64 0c-13.255 0-24 10.745-24 24s10.745 24 24 24 24-10.745 24-24-10.745-24-24-24z" class=""></path></svg>
    <h3>
      {{chatName}}
      <span *ngIf="members">{{members}}</span>
      <svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="heart" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" class="svg-inline--fa fa-heart fa-w-16"><path fill="currentColor" d="M462.3 62.6C407.5 15.9 326 24.3 275.7 76.2L256 96.5l-19.7-20.3C186.1 24.3 104.5 15.9 49.7 62.6c-62.8 53.6-66.1 149.8-9.9 207.9l193.5 199.8c12.5 12.9 32.8 12.9 45.3 0l193.5-199.8c56.3-58.1 53-154.3-9.8-207.9z" class=""></path></svg>
    </h3>
    <div class="subtitle" *ngIf="topic">{{topic}}</div>
  </header>
  <header *ngIf="embd" class="embedded">
    <div class="subtitle" *ngIf="topic">{{topic}}</div>
    <a *ngIf="embd" class="fullVersion" target="_blank" [href]="fullVersionLink">Full version</a>
  </header>
  <section id="cboxMessages"
  (drop)="onDrop($event)"
  (dragover)="onDragOver($event)">
    <div class="messageItem" *ngFor="let message of messages" [class.server]="message.messageType === 'SERVER'" [class.notice]="message.messageType === 'NOTICE'" [class.embedded]="embd">
      <div style="display: none;">
        {{dumpMessage(message)}}
      </div>
      <div class="channelMSG" *ngIf="message.messageType === 'CHANNEL_MSG' || message.messageType === 'PRIV_MSG'" [class.fromLog]="message.data.fromLog">
        <nav class="actions" *ngIf="!message.data.meAction || !embd">
          <svg (click)="doQuote(message.data.privateAuthor ? message.data.privateAuthor : message.data.author, message.data.richMessage ? message.data.richMessage.message : message.data.message)" aria-hidden="true" focusable="false" data-prefix="fas" data-icon="comment-alt" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" class="svg-inline--fa fa-comment-alt fa-w-16"><path fill="currentColor" d="M448 0H64C28.7 0 0 28.7 0 64v288c0 35.3 28.7 64 64 64h96v84c0 9.8 11.2 15.5 19.1 9.7L304 416h144c35.3 0 64-28.7 64-64V64c0-35.3-28.7-64-64-64z" class=""></path></svg>
        </nav>
        <img *ngIf="!message.data.privateAuthor && !message.data.meAction" src="https://avatars.dicebear.com/api/jdenticon/{{message.data.author}}.svg?options[colorful]=1" />
        <img *ngIf="message.data.privateAuthor && !message.data.meAction" src="https://avatars.dicebear.com/api/jdenticon/{{message.data.privateAuthor}}.svg?options[colorful]=1" />
        <div class="messageBody" [class.mentioned]="message.data.mention" *ngIf="!message.data.meAction">
          <div class="author" *ngIf="!message.data.privateAuthor" (click)="openPrivate(message.data.author)">{{message.data.author}}<span class="hs">{{message.data.date}} {{message.data.time}}</span></div>
          <div class="author" *ngIf="message.data.privateAuthor">{{message.data.privateAuthor}}<span class="hs">{{message.data.date}} {{message.data.time}}</span></div>
          <div class="quote" *ngIf="message.data.richMessage?.quote">
            <svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="quote-right" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" class="svg-inline--fa fa-quote-right fa-w-16"><path fill="currentColor" d="M464 32H336c-26.5 0-48 21.5-48 48v128c0 26.5 21.5 48 48 48h80v64c0 35.3-28.7 64-64 64h-8c-13.3 0-24 10.7-24 24v48c0 13.3 10.7 24 24 24h8c88.4 0 160-71.6 160-160V80c0-26.5-21.5-48-48-48zm-288 0H48C21.5 32 0 53.5 0 80v128c0 26.5 21.5 48 48 48h80v64c0 35.3-28.7 64-64 64h-8c-13.3 0-24 10.7-24 24v48c0 13.3 10.7 24 24 24h8c88.4 0 160-71.6 160-160V80c0-26.5-21.5-48-48-48z" class=""></path></svg>
            <span class="author" (click)="openPrivate(message.data.richMessage.quote.author)">
              {{message.data.richMessage.quote.author}}
            </span>
            {{message.data.richMessage.quote.originalMessage}}
          </div>
          <span *ngIf="!message.data.richMessage">
            {{message.data.message}}
          </span>
          <span *ngIf="message.data.richMessage" [innerHTML]="message.data.richMessage.message"></span>
          <a *ngIf="message.data.richMessage?.image" [href]="message.data.richMessage.image" target="_blank">
            <img [src]="message.data.richMessage.image" class="banner" />
          </a>
          <iframe *ngIf="message.data.richMessage?.youtube" width="560" height="315" [src]="'https://www.youtube.com/embed/' + message.data.richMessage.youtube | safe: 'resourceUrl'" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
          <app-link-vcard *ngIf="message.data.richMessage?.link" [link]="message.data.richMessage.link"></app-link-vcard>
        </div>
        <div class="messageBody actionOrigin" *ngIf="message.data.meAction">
          <span *ngIf="!message.data.privateAuthor">{{message.data.author}}</span>
          <span *ngIf="message.data.privateAuthor">{{message.data.privateAuthor}}</span>
          <span>
            {{message.data.message}}
          </span>
        </div>
      </div>
      <div class="serverMSG" *ngIf="message.messageType === 'SERVER' || message.messageType === 'NOTICE'">
        <div class="messageBody">
          <div class="author"(click)="openPrivate(message.data.simplyOrigin)">{{message.data.simplyOrigin}}</div>
          {{message.data.message}}
        </div>
      </div>
      <div class="joinMSG" *ngIf="message.messageType === 'USER_JOINING'">
        <img src="https://avatars.dicebear.com/api/jdenticon/{{message.data.user}}.svg?options[colorful]=1" />
        <div class="messageBody">
          <div class="author" (click)="openPrivate(message.data.user)">{{message.data.user}}</div>
          Entr贸 al canal, {{message.data.userMsg}} <img src="assets/door.jpg" class="notifyDecoration"/>
        </div>
      </div>
      <div class="leaveMSG" *ngIf="message.messageType === 'USER_LEAVING'">
        <img src="https://avatars.dicebear.com/api/jdenticon/{{message.data.user}}.svg?options[colorful]=1" />
        <div class="messageBody">
          <div class="author" (click)="openPrivate(message.data.user)">{{message.data.user}}</div>
          Sali贸 del canal, {{message.data.message}}
        </div>
      </div>
      <div class="kickMSG" *ngIf="message.messageType === 'KICK'">
        <img src="https://avatars.dicebear.com/api/jdenticon/{{message.data.user}}.svg?options[colorful]=1" />
        <div class="messageBody">
          <div class="author" (click)="openPrivate(message.data.user)">{{message.data.user}}</div>
          {{message.data.message}}
        </div>
      </div>
      <div class="banMSG" *ngIf="message.messageType === 'BAN'">
        <div class="messageBody">
          Se aplic贸 ban a {{message.data}} <img src="assets/door.jpg" class="notifyDecoration"/>
        </div>
      </div>
      <div class="changeNickMSG" *ngIf="message.messageType === 'NICK_CHANGED' && !embd">
        <img src="https://avatars.dicebear.com/api/jdenticon/{{message.data.newNick}}.svg?options[colorful]=1" />
        <div class="messageBody" style="vertical-align: middle;">
          <b>
            {{message.data.origin}}
          </b> Se cambi贸 el nick a:
          <div class="author" style="display: inline-block;" (click)="openPrivate(message.data.newNick)">{{message.data.newNick}}</div>
        </div>
      </div>
    </div>
  </section>
  <footer
  (drop)="onDrop($event)"
  (dragover)="onDragOver($event)">
    <div class="quote" *ngIf="inQuote">
      <svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="quote-right" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" class="svg-inline--fa fa-quote-right fa-w-16"><path fill="currentColor" d="M464 32H336c-26.5 0-48 21.5-48 48v128c0 26.5 21.5 48 48 48h80v64c0 35.3-28.7 64-64 64h-8c-13.3 0-24 10.7-24 24v48c0 13.3 10.7 24 24 24h8c88.4 0 160-71.6 160-160V80c0-26.5-21.5-48-48-48zm-288 0H48C21.5 32 0 53.5 0 80v128c0 26.5 21.5 48 48 48h80v64c0 35.3-28.7 64-64 64h-8c-13.3 0-24 10.7-24 24v48c0 13.3 10.7 24 24 24h8c88.4 0 160-71.6 160-160V80c0-26.5-21.5-48-48-48z" class=""></path></svg>
      <span class="author">
        {{quoteAuthor}}
      </span>
      {{quoteMessage}}
      <svg (click)="inQuote = false" aria-hidden="true" focusable="false" data-prefix="fas" data-icon="times" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 352 512" class="svg-inline--fa fa-times fa-w-11"><path fill="currentColor" d="M242.72 256l100.07-100.07c12.28-12.28 12.28-32.19 0-44.48l-22.24-22.24c-12.28-12.28-32.19-12.28-44.48 0L176 189.28 75.93 89.21c-12.28-12.28-32.19-12.28-44.48 0L9.21 111.45c-12.28 12.28-12.28 32.19 0 44.48L109.28 256 9.21 356.07c-12.28 12.28-12.28 32.19 0 44.48l22.24 22.24c12.28 12.28 32.2 12.28 44.48 0L176 322.72l100.07 100.07c12.28 12.28 32.2 12.28 44.48 0l22.24-22.24c12.28-12.28 12.28-32.19 0-44.48L242.72 256z" class=""></path></svg>
    </div>
    <input type="text" id="cboxInput" placeholder="your message" (keypress)="send($event)" (keydown)="kdown($event)"/>
    <input type="file" style="display: none;" accept="image/*" id="fileInput" (change)="onFileSelected($event)"/>
    <button (click)="openFile()">
      <svg *ngIf="imageLoading" aria-hidden="true" focusable="false" data-prefix="fas" data-icon="spinner" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" class="svg-inline--fa fa-spinner fa-w-16"><path fill="currentColor" d="M304 48c0 26.51-21.49 48-48 48s-48-21.49-48-48 21.49-48 48-48 48 21.49 48 48zm-48 368c-26.51 0-48 21.49-48 48s21.49 48 48 48 48-21.49 48-48-21.49-48-48-48zm208-208c-26.51 0-48 21.49-48 48s21.49 48 48 48 48-21.49 48-48-21.49-48-48-48zM96 256c0-26.51-21.49-48-48-48S0 229.49 0 256s21.49 48 48 48 48-21.49 48-48zm12.922 99.078c-26.51 0-48 21.49-48 48s21.49 48 48 48 48-21.49 48-48c0-26.509-21.491-48-48-48zm294.156 0c-26.51 0-48 21.49-48 48s21.49 48 48 48 48-21.49 48-48c0-26.509-21.49-48-48-48zM108.922 60.922c-26.51 0-48 21.49-48 48s21.49 48 48 48 48-21.49 48-48-21.491-48-48-48z" class=""></path></svg>
      <svg *ngIf="!imageLoading" aria-hidden="true" focusable="false" data-prefix="fas" data-icon="image" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" class="svg-inline--fa fa-image fa-w-16"><path fill="currentColor" d="M464 448H48c-26.51 0-48-21.49-48-48V112c0-26.51 21.49-48 48-48h416c26.51 0 48 21.49 48 48v288c0 26.51-21.49 48-48 48zM112 120c-30.928 0-56 25.072-56 56s25.072 56 56 56 56-25.072 56-56-25.072-56-56-56zM64 384h384V272l-87.515-87.515c-4.686-4.686-12.284-4.686-16.971 0L208 320l-55.515-55.515c-4.686-4.686-12.284-4.686-16.971 0L64 336v48z" class=""></path></svg>
    </button>
  </footer>
</main>
